<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æå®¶å¹´èœ - å¾Œå°ç®¡ç†</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="assets/store.js"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f4f6f9;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
        }

        .sidebar-header {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 700;
            background-color: rgba(0, 0, 0, 0.1);
        }

        .nav-links {
            list-style: none;
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--primary-blue);
        }

        /* Main */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 30px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
        }

        /* Status Cards */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #3498db;
        }

        .status-card h3 {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .status-card .value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        /* Table */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8f9fa;
            color: #7f8c8d;
            font-weight: 600;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-new {
            background: var(--status-new-bg);
            color: var(--status-new-text);
        }

        .status-completed {
            background: var(--status-completed-bg);
            color: var(--status-completed-text);
        }

        /* Modal tweaks */
        .detail-row {
            display: flex;
            margin-bottom: 15px;
        }

        .detail-label {
            width: 100px;
            font-weight: 700;
            color: #7f8c8d;
        }

        .order-items {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
    </style>
</head>

<body>

    <aside class="sidebar">
        <div class="sidebar-header">æå®¶å¹´èœ - å¾Œå°</div>
        <ul class="nav-links">
            <li class="nav-item active" onclick="switchTab('orders')" id="nav-orders">ğŸ“‹ è¨‚å–®ç®¡ç†</li>
            <li class="nav-item" onclick="switchTab('stats')" id="nav-stats">ğŸ‘¨â€ğŸ³ å»šæˆ¿çµ±è¨ˆ</li>
            <li class="nav-item" onclick="switchTab('menu')" id="nav-menu">ğŸ² èœå–®è¨­å®š</li>
            <li class="nav-item" onclick="switchTab('system')" id="nav-system">âš™ï¸ ç³»çµ±è¨­å®š</li>
        </ul>
    </aside>

    <main class="main-content">
        <div class="header">
            <div class="page-title-area" style="display:flex; align-items:center;">
                <button id="sidebarToggle" onclick="toggleSidebar()">â˜°</button>
                <h1 class="page-title" id="pageTitle">è¨‚å–®ç®¡ç†</h1>
            </div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="searchInput" class="form-input" placeholder="ğŸ” æœå°‹è¨‚å–® (ç·¨è™Ÿ/å§“å/é›»è©±)"
                    style="width:250px;">
                <button class="btn btn-outline" onclick="location.reload()">ğŸ”„ é‡æ–°æ•´ç†</button>
            </div>
        </div>

        <!-- Orders Section -->
        <div id="ordersSection">
            <div class="status-grid">
                <div class="status-card" style="border-left-color: #3498db;">
                    <h3>ç¸½è¨‚å–®æ•¸</h3>
                    <div class="value" id="statsTotal">0</div>
                </div>
                <div class="status-card" style="border-left-color: #e74c3c;">
                    <h3>æ–°è¨‚å–®</h3>
                    <div class="value" id="statsNew">0</div>
                </div>
                <div class="status-card" style="border-left-color: #2ecc71;">
                    <h3>ç¸½ç‡Ÿæ”¶</h3>
                    <div class="value" id="statsRevenue">NT$ 0</div>
                </div>
            </div>

            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th onclick="toggleSort('id')" style="cursor:pointer; user-select:none;">
                                è¨‚å–®ç·¨è™Ÿ <span id="sort-id-icon">â–¼</span>
                            </th>
                            <th>è¨‚è³¼äºº</th>
                            <th>é›»è©±</th>
                            <th>ä»˜æ¬¾</th>
                            <th>ç¸½é‡‘é¡</th>
                            <th onclick="toggleSort('status')" style="cursor:pointer; user-select:none;">
                                è¨‚å–®ç‹€æ…‹ <span id="sort-status-icon" style="color:#ccc; font-size:0.8rem;">â–¼</span>
                            </th>
                            <th onclick="toggleSort('time')" style="cursor:pointer; user-select:none;">
                                æ™‚é–“ <span id="sort-time-icon" style="color:#ccc;">â–¼</span>
                            </th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        <!-- JS Injected -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Kitchen Stats Section -->
        <div id="statsSection" class="hidden">
            <div class="card">
                <div
                    style="padding:20px; border-bottom:1px solid #eee; background:#fff8e1; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h3 style="color:#d35400; margin-bottom:5px;">âš ï¸ å»šæˆ¿å‚™æ–™çµ±è¨ˆ</h3>
                        <p style="color:#666; margin:0;">çµ±è¨ˆæ‰€æœ‰ã€Œæ–°è¨‚å–®ã€èˆ‡ã€Œå·²å®Œæˆã€çš„è¨‚å–®ã€‚</p>
                    </div>
                    <button onclick="printStats()" class="btn btn-outline"
                        style="border-color:#d35400; color:#d35400; background:white;">ğŸ–¨ï¸ åˆ—å°å‚™æ–™å–®</button>
                </div>

                <div style="padding: 20px 20px 10px 20px;">
                    <h4 style="margin-bottom: 5px; color: #555;">ğŸ“ å»šæˆ¿å‚™æ–™æ¸…å–® (ä¾èœå–®ç·¨è™Ÿ)</h4>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>èœè‰²åç¨±</th>
                            <th>ç¸½æ•¸é‡</th>
                        </tr>
                    </thead>
                    <tbody id="kitchenTableBody">
                        <!-- JS Injected -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Menu Section -->
        <div id="menuSection" class="hidden">
            <div style="margin-bottom: 20px; display: flex; justify-content: flex-end;">
                <button class="btn btn-primary" onclick="openProductModal()">+ æ–°å¢èœè‰²</button>
            </div>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>åç¨±</th>
                            <th>åƒ¹æ ¼</th>
                            <th>æè¿°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="menuTableBody">
                        <!-- JS Injected -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- System Section -->
        <section id="systemSection" class="hidden">
            <h2 style="margin-bottom:20px; color:#333;">è³‡æ–™å®‰å…¨ç®¡ç†</h2>
            <div class="status-grid">
                <div class="status-card" style="border-left: 4px solid #3498db;">
                    <h3>å ±è¡¨åŒ¯å‡º</h3>
                    <p style="color:#666; margin-bottom:15px; font-size:0.9rem;">åŒ¯å‡º Excel (CSV) æ ¼å¼çš„è¨‚å–®æ˜ç´°å ±è¡¨ã€‚</p>
                    <button class="btn" style="background:#3498db; color:white; width:100%; border:none; padding:10px;"
                        onclick="exportToExcel()">ğŸ“Š åŒ¯å‡ºè¨‚å–®å ±è¡¨</button>
                </div>

                <div class="status-card" style="border-left: 4px solid #8e44ad;">
                    <h3>è³‡æ–™å‚™ä»½</h3>
                    <p style="color:#666; margin-bottom:15px; font-size:0.9rem;">å°‡æ‰€æœ‰è¨‚å–®èˆ‡èœå–®è³‡æ–™ä¸‹è¼‰ç‚ºæª”æ¡ˆï¼Œä»¥é˜²ä¸Ÿå¤±ã€‚</p>
                    <button class="btn" style="background:#8e44ad; color:white; width:100%; border:none; padding:10px;"
                        onclick="downloadBackup()">ğŸ“¥ åŒ¯å‡ºè³‡æ–™ (å‚™ä»½)</button>
                </div>

                <div class="status-card" style="border-left: 4px solid #27ae60;">
                    <h3>è³‡æ–™é‚„åŸ</h3>
                    <p style="color:#666; margin-bottom:15px; font-size:0.9rem;">å¾å‚™ä»½æª”æ¡ˆæ¢å¾©è³‡æ–™ (æ³¨æ„ï¼šæœƒè¦†è“‹ç¾æœ‰è³‡æ–™)ã€‚</p>
                    <input type="file" id="importFile" style="display:none" accept=".json"
                        onchange="restoreBackup(this)">
                    <button class="btn" style="background:#27ae60; color:white; width:100%; border:none; padding:10px;"
                        onclick="document.getElementById('importFile').click()">ğŸ“¤ åŒ¯å…¥è³‡æ–™ (é‚„åŸ)</button>
                </div>

                <div class="status-card" style="border-left: 4px solid #c0392b;">
                    <h3>é‡ç½®ç³»çµ±</h3>
                    <p style="color:#666; margin-bottom:15px; font-size:0.9rem;">æ¸…é™¤æ‰€æœ‰è¨‚å–®èˆ‡è¨­å®šï¼Œå›åˆ°åˆå§‹ç‹€æ…‹ã€‚</p>
                    <button class="btn" style="background:#c0392b; color:white; width:100%; border:none; padding:10px;"
                        onclick="if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸï¼')) { localStorage.clear(); location.reload(); }">âš ï¸
                        æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Detail Modal -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div
                style="display:flex; justify-content:space-between; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                <h2 id="modalId"></h2>
                <span onclick="closeModal()" style="cursor:pointer; font-size:1.5rem;">Ã—</span>
            </div>

            <div class="detail-row">
                <div class="detail-label">è¨‚è³¼äºº</div>
                <div id="modalName"></div>
            </div>
            <div class="detail-row">
                <div class="detail-label">é›»è©±</div>
                <div id="modalPhone"></div>
            </div>
            <div class="detail-row">
                <div class="detail-label">å‚™è¨»</div>
                <div id="modalNote" style="color:#666; font-style:italic;"></div>
            </div>

            <div class="order-items" id="modalItems"></div>

            <div style="text-align:right; font-size:1.2rem; font-weight:700; color:#c62828;">
                ç¸½è¨ˆ: <span id="modalTotal"></span>
            </div>

            <div style="margin-top:30px; display:flex; gap:10px; align-items:center;">
                <button class="btn btn-outline"
                    style="border-color:#e74c3c; color:#e74c3c; padding:8px 15px; font-size:0.9rem;"
                    onclick="deleteCurrentOrder()">ğŸ—‘ï¸ åˆªé™¤</button>
                <div style="flex:1;"></div>
                <button class="btn btn-outline" style="border:none; color:#666;" onclick="closeModal()">é—œé–‰</button>
                <button class="btn btn-outline" style="padding:8px 15px;" onclick="enableEditMode()">âœï¸ ç·¨è¼¯</button>
                <button class="btn" style="background:#27ae60; color:white; border:none; padding:8px 15px;"
                    onclick="updateStatus('completed')">âœ… æ¨™è¨˜å®Œæˆ</button>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;" id="productModalTitle">æ–°å¢èœè‰²</h2>
            <form onsubmit="saveProduct(event)">
                <input type="hidden" id="pId">
                <div class="form-group">
                    <label class="form-label">èœè‰²åç¨±</label>
                    <input type="text" class="form-input" id="pName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">åƒ¹æ ¼</label>
                    <input type="number" class="form-input" id="pPrice" required>
                </div>
                <div class="form-group">
                    <label class="form-label">æè¿°</label>
                    <textarea class="form-textarea" id="pDesc"></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-outline" onclick="closeProductModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script src="assets/admin.js"></script>
</body>

</html>